<!DOCTYPE html>
<html>
<head>
    <title>Технические индикаторы</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; background: #f8f9fa; }
        .card { background: #fff; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); max-width: 900px; margin: auto; }
        .title { font-size: 1.5rem; font-weight: bold; margin-bottom: 1.5rem; }
        .button-row { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; }
        .btn { padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer; }
        .btn.active { background-color: red; color: white; }
        .btn.available { background-color: green; color: white; }
        .btn.inactive { background-color: #ccc; color: white; }
        select { padding: 0.5rem; border-radius: 6px; margin-left: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem; border-bottom: 1px solid #ddd; text-align: center; }
        th { background: #f1f1f1; font-weight: 600; }
    </style>
</head>
<body>
    <div class="card">
        <h1 class="title">Технические индикаторы</h1>

        <!-- Ряд кнопок индикаторов -->
        <div class="button-row">
            <a href="/indicators?type=ema&tf={{ tf }}" class="btn {% if type == 'ema' %}active{% else %}available{% endif %}">EMA</a>
            <a href="/indicators?type=smi&tf={{ tf }}" class="btn {% if type == 'smi' %}active{% else %}available{% endif %}">SMI</a>
            <a href="#" class="btn inactive">RSI</a>
            <a href="#" class="btn inactive">MACD</a>
            <a href="#" class="btn inactive">LR</a>
            <a href="#" class="btn inactive">ATR</a>

            <!-- Выпадающий выбор TF -->
            <form method="get" action="/indicators" style="margin-left:auto;">
                <input type="hidden" name="type" value="{{ type }}">
                <select name="tf" onchange="this.form.submit()">
                    <option value="M1" {% if tf == 'M1' %}selected{% endif %}>M1</option>
                    <option value="M5" {% if tf == 'M5' %}selected{% endif %}>M5</option>
                    <option value="M15" {% if tf == 'M15' %}selected{% endif %}>M15</option>
                </select>
            </form>
        </div>

        {% if type == 'ema' %}
        <!-- Таблица значений EMA -->
        <table>
            <thead>
                <tr>
                    <th>№</th>
                    <th>Тикер</th>
                    <th>TF</th>
                    <th>EMA50</th>
                    <th>EMA100</th>
                    <th>EMA200</th>
                    <th>Последнее обновление</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ row.symbol }}</td>
                    <td>{{ row.tf }}</td>
                    <td>{{ row.ema50 or 'n/a' }}</td>
                    <td>{{ row.ema100 or 'n/a' }}</td>
                    <td>{{ row.ema200 or 'n/a' }}</td>
                    <td>{{ row.updated_at or 'n/a' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% elif type == 'smi' %}
        <!-- Таблица значений SMI -->
        <table>
            <thead>
                <tr>
                    <th>№</th>
                    <th>Тикер</th>
                    <th>TF</th>
                    <th>SMI</th>
                    <th>SMI Signal</th>
                    <th>Дата обновления</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ row.symbol }}</td>
                    <td>{{ row.tf }}</td>
                    <td>{{ row.smi or 'n/a' }}</td>
                    <td>{{ row.smi_signal or 'n/a' }}</td>
                    <td>{{ row.updated_at or 'n/a' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</body>
</html>
