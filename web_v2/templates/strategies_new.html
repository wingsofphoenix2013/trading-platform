<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/lucide-static@latest/icons.css" rel="stylesheet">
    <script>
  function generateTPRows() {
    const count = parseInt(document.getElementById('tp_count').value);
    const container = document.getElementById('tp_table');
    document.getElementById("tp_count_hidden").value = count;  // üîπ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Ä–æ–≤–Ω–µ–π
    container.innerHTML = '';
    for (let i = 1; i <= count; i++) {
      container.innerHTML += `
        <tr class="border-t">
          <td class="px-3 py-2">${i}</td>
          <td>
            <input type="number" name="volume_${i}" class="w-full px-2 py-1 border rounded" placeholder="%" />
          </td>
          <td>
            <select name="tp_type_${i}" class="w-full px-2 py-1 border rounded" onchange="toggleTPValueInput(${i}, this.value)">
              <option value="">–í—ã–±–æ—Ä...</option>
              <option value="percent">percent</option>
              <option value="atr">atr</option>
              <option value="fixed">fixed</option>
              <option value="external_signal">external_signal</option>
            </select>
          </td>
          <td id="tp_value_cell_${i}"></td>
        </tr>`;
    }
  }

function toggleTPValueInput(level, type) {
  const cell = document.getElementById(`tp_value_cell_${level}`);
  if (type === 'external_signal') {
    cell.innerHTML = `
const optionsTemplate = document.getElementById("exit-signal-options").innerHTML;
cell.innerHTML = `
  <select name="tp_value_${level}" class="w-full px-2 py-1 border rounded">
    <option value="">–í—ã–±–æ—Ä...</option>
    ${optionsTemplate}
  </select>`;
  } else if (['percent', 'atr', 'fixed'].includes(type)) {
    cell.innerHTML = `
      <input name="tp_value_${level}" type="number" step="any" class="w-full px-2 py-1 border rounded" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ" />`;
  } else {
    cell.innerHTML = '';
  }
}

  function handleTickerToggle() {
    const checkboxes = document.querySelectorAll('.ticker-checkbox');
    const allTickersCheckbox = document.getElementById('use_all_tickers');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    allTickersCheckbox.disabled = !allChecked;
    allTickersCheckbox.checked = allChecked;
  }

  function handleAllTickersToggle() {
    const state = document.getElementById('use_all_tickers').checked;
    const checkboxes = document.querySelectorAll('.ticker-checkbox');
    checkboxes.forEach(cb => cb.checked = state);
    document.getElementById('use_all_tickers').disabled = state;
  }
</script>
    <style>
      body {
        background: linear-gradient(to bottom right, #e0f2ff, #fde2e4);
      }
    </style>
  </head>
  <body class="min-h-screen font-sans text-slate-800">
    <!-- üî∏ Topbar Navigation -->
    <header class="w-full bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
        <h1 class="text-2xl font-semibold text-blue-900 tracking-wide">–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¢–æ—Ä–≥–æ–≤–ª—è</h1>
        <nav class="space-x-4 text-sm font-medium text-slate-700">
          <a href="/" class="hover:text-blue-600 transition-colors">–ì–ª–∞–≤–Ω–∞—è</a>
          <a href="/tickers" class="hover:text-blue-600 transition-colors">–¢–∏–∫–µ—Ä—ã</a>
          <a href="/indicators" class="hover:text-blue-600 transition-colors">–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã</a>
          <a href="/signals" class="hover:text-blue-600 transition-colors">–°–∏–≥–Ω–∞–ª—ã</a>
          <a href="/strategies" class="text-blue-700 font-semibold">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</a>
        </nav>
      </div>
    </header>

    <!-- üî∏ Page Content -->
    <main class="max-w-7xl mx-auto px-4 py-10">
<form method="POST" action="/strategies/new" class="space-y-10">    
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-semibold text-blue-900">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
      </div>
<!-- üîπ –ë–ª–æ–∫ 1: –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="max-w-4xl mx-auto px-6 py-8 bg-white/80 rounded-2xl shadow-xl space-y-10">
  <section class="space-y-4">
    <h3 class="text-xl font-semibold text-blue-800">–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <input name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="w-full px-3 py-2 border rounded" />
    <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="w-full px-3 py-2 border rounded"></textarea>
    <div class="grid grid-cols-3 gap-4">
      <input name="deposit" type="number" placeholder="–î–µ–ø–æ–∑–∏—Ç" class="w-full px-3 py-2 border rounded" />
      <input name="position_limit" type="number" placeholder="–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏" class="w-full px-3 py-2 border rounded" />
      <input name="max_risk" type="number" placeholder="–ú–∞–∫—Å. —Ä–∏—Å–∫, %" class="w-full px-3 py-2 border rounded" />
    </div>
    <input name="leverage" type="number" placeholder="–ü–ª–µ—á–æ (leverage)" class="w-full px-3 py-2 border rounded" />
<select name="action_signal_id" class="w-full px-3 py-2 border rounded">
  <option value="">–í—ã–±–æ—Ä —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞...</option>
  {% for s in signals %}
    <option value="{{ s.id }}">{{ s.name }} [{{ 'enabled' if s.enabled else 'disabled' }}]</option>
  {% endfor %}
</select>
    <select name="timeframe" class="w-full px-3 py-2 border rounded">
      <option>–í—ã–±–æ—Ä —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞...</option>
      <option>M1</option>
      <option>M5</option>
      <option>M15</option>
    </select>
    <label class="inline-flex items-center space-x-2 text-sm text-slate-700">
      <input name="reverse" type="checkbox" />
      <span>–†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–≤–µ—Ä—Å—ã (reverse)</span>
    </label>
  </section>
</div>
<br>
<!-- üîπ –ë–ª–æ–∫ 2: SL -->
<div class="max-w-4xl mx-auto px-6 py-8 bg-white/80 rounded-2xl shadow-xl space-y-10">
  <section class="space-y-4">
    <h3 class="text-xl font-semibold text-blue-800">Stop-Loss</h3>
    <label><input name="use_stoploss" type="checkbox" checked /> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SL</label>
    <select name="sl_type" class="w-full px-3 py-2 border rounded">
      <option>–í—ã–±–æ—Ä —Ç–∏–ø–∞ SL...</option>
      <option value="percent">percent</option>
      <option value="atr">atr</option>
    </select>
    <input name="sl_value" type="number" placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ SL" class="w-full px-3 py-2 border rounded" />
  </section>
</div>
<br>
      <!-- üîπ –ë–ª–æ–∫ 3: TP -->
      <div class="max-w-4xl mx-auto px-6 py-8 bg-white/80 rounded-2xl shadow-xl space-y-10">
      <section class="space-y-4">
        <h3 class="text-xl font-semibold text-blue-800">Take Profit</h3>
        <select id="tp_count" onchange="generateTPRows()" class="w-full px-3 py-2 border rounded">
          <option value="">–í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–≤–Ω–µ–π...</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
        <table class="w-full table-auto text-sm text-left border rounded">
          <thead class="bg-slate-100">
            <tr>
              <th class="px-3 py-2">#</th>
              <th class="px-3 py-2">–û–±—ä—ë–º, %</th>
              <th class="px-3 py-2">–¢–∏–ø TP</th>
              <th class="px-3 py-2">–ó–Ω–∞—á–µ–Ω–∏–µ / –°–∏–≥–Ω–∞–ª</th>
            </tr>
          </thead>
          <tbody id="tp_table" class="bg-white/80"></tbody>
        </table>
      </section>
      </div>
      <br>
<!-- üîπ –ë–ª–æ–∫ 4: –¢–∏–∫–µ—Ä—ã -->
<div class="max-w-4xl mx-auto px-6 py-8 bg-white/80 rounded-2xl shadow-xl space-y-10">
  <section class="space-y-4">
    <h3 class="text-xl font-semibold text-blue-800 flex items-center justify-between">
      –¢–∏–∫–µ—Ä—ã
      <label class="text-sm">
        <input name="use_all_tickers" type="checkbox" id="use_all_tickers" checked onchange="handleAllTickersToggle()" />
        –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ
      </label>
    </h3>

    <!-- üîπ –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ TP -->
    <input type="hidden" id="tp_count_hidden" name="tp_count" />
    <table class="w-full table-auto text-sm text-left border rounded">
      <thead class="bg-slate-100">
        <tr>
          <th class="px-3 py-2">#</th>
          <th class="px-3 py-2">–¢–∏–∫–µ—Ä</th>
          <th class="px-3 py-2">–°—Ç–∞—Ç—É—Å</th>
          <th class="px-3 py-2">–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ</th>
          <th class="px-3 py-2">‚úÖ</th>
        </tr>
      </thead>
      <tbody class="bg-white/80">
        {% for t in tickers %}
        <tr>
          <td class="px-3 py-2">{{ loop.index }}</td>
          <td>{{ t.symbol }}</td>
          <td>{{ t.status }}</td>
          <td>{{ t.tradepermission }}</td>
          <td>
            <input name="ticker_{{ t.symbol }}" type="checkbox" checked class="ticker-checkbox" onchange="handleTickerToggle()" />
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
<br>
      <!-- üîπ –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å -->
      <div class="text-center">
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-xl shadow hover:bg-blue-700 hover:shadow-lg transition-all">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
      </div>
</form>      
    </main>
<template id="exit-signal-options">
  {% for s in exit_signals %}
    <option value="{{ s.id }}">{{ s.name }} [{{ 'enabled' if s.enabled else 'disabled' }}]</option>
  {% endfor %}
</template>    
  </body>
</html>
